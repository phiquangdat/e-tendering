<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage User-Category Relationships</title>
    <script>
        function fetchUsers() {
            fetch("http://localhost:5500/users")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(users => {
                    const userCategoryDropdown = document.getElementById("user_category_user_id");
                    userCategoryDropdown.innerHTML = ""; // Clear existing options
                    users.forEach(user => {
                        const option = document.createElement("option");
                        option.value = user.user_id;
                        option.textContent = user.name;
                        userCategoryDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error("Error fetching users:", error));
        }

        function fetchCategories() {
            fetch("http://localhost:5500/categories")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(categories => {
                    const categoryDropdown = document.getElementById("user_category_category_id");
                    categoryDropdown.innerHTML = ""; // Clear existing options
                    categories.forEach(category => {
                        const option = document.createElement("option");
                        option.value = category.category_id;
                        option.textContent = category.category_name;
                        categoryDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error("Error fetching categories:", error));
        }

        function addUserToCategory() {
            const user_id = document.getElementById("user_category_user_id").value;
            const category_id = document.getElementById("user_category_category_id").value;

            fetch("http://localhost:5500/add_user_to_category", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ user_id, category_id })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("Error:", error));
        }

        function removeUserFromCategory() {
            const user_id = document.getElementById("user_category_user_id").value;
            const category_id = document.getElementById("user_category_category_id").value;

            fetch("http://localhost:5500/remove_user_from_category", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ user_id, category_id })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("Error:", error));
        }

        window.onload = function() {
            fetchUsers(); // Fetch and display the list of users on page load
            fetchCategories(); // Fetch and display the list of categories on page load
        };
    </script>
</head>
<body>
    <h2>Manage User-Category Relationships</h2>
    <form onsubmit="event.preventDefault(); addUserToCategory();">
        <label>User ID: 
            <select id="add_user_category_user_id" required>
                <!-- Options will be populated dynamically -->
            </select>
        </label><br>
        <label>Category ID: 
            <select id="add_user_category_category_id" required>
                <!-- Options will be populated dynamically -->
            </select>
        </label><br>
        <button type="submit">Add User to Category</button>
    </form>

    <form onsubmit="event.preventDefault(); removeUserFromCategory();">
        <label>User ID: 
            <select id="remove_user_category_user_id" required>
                <!-- Options will be populated dynamically -->
            </select>
        </label><br>
        <label>Category ID: 
            <select id="remove_user_category_category_id" required>
                <!-- Options will be populated dynamically -->
            </select>
        </label><br>
        <button type="submit">Remove User from Category</button>
    </form>
</body>
</html>
